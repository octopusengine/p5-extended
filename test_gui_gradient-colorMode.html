<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="dark.css">
<script src="js/p5.min.js"></script>
<script src="js/box_gui.js"></script>
</head>
<body>

<script>
// sketch.js

let sliderSize, sliderSpeed;
let angle = 0;
let myEffectShape; // Renamed instance to myEffectShape

// Predefined colors for easy switching
let backgroundHSBColor;
let shadowHSBColor;
let squareStartHSBColor;
let squareEndHSBColor;
let sliderLineRGB1;
let sliderLineRGB2;
let labelHSBColor; // Labels will use HSB since main colorMode is HSB

function setup() {
  createCanvas(800, 800);
  angleMode(DEGREES);
  rectMode(CENTER);
  noStroke();

  // --- Define colors for HSB mode ---
  // Set HSB mode to create HSB colors for square, background, shadow, and label
  colorMode(HSB, 360, 100, 100, 100);
  backgroundHSBColor = color(230, 30, 23);
  shadowHSBColor = color(230, 30, 18, 100);
  squareStartHSBColor = color(310, 100, 100, 100);
  squareEndHSBColor = color(250, 100, 100, 100);
  labelHSBColor = color(0, 0, 100); // White for better contrast with background, or green color(120, 100, 80)

  // Create instance of EffectShape class
  myEffectShape = new EffectShape(this);
  myEffectShape.setShadowColor(shadowHSBColor); // Pass HSB color for shadow
  myEffectShape.blur(false); // Start with blur turned off

  // --- Define colors for RGB mode ---
  // Switch to RGB to create RGB colors for sliders
  colorMode(RGB, 255);
  sliderLineRGB1 = color(0, 255, 0);
  sliderLineRGB2 = color(0, 100, 0);

  // Initialize sliders - will use RGB colors
  sliderSize = new BoxSlider(100, 650, 300, 20, 50, 200, 400);
  sliderSize.lineCol1 = sliderLineRGB1;
  sliderSize.lineCol2 = sliderLineRGB2;

  sliderSpeed = new BoxSlider(100, 700, 300, 20, 0, 1, 5);
  sliderSpeed.lineCol1 = sliderLineRGB1;
  sliderSpeed.lineCol2 = sliderLineRGB2;
  
  // At the end of setup, set default colorMode for `draw` back to HSB,
  // because most content (background, square) uses HSB.
  colorMode(HSB, 360, 100, 100, 100);
}

function draw() {
  // --- Draw background and rotating square (HSB) ---
  colorMode(HSB, 360, 100, 100, 100); // Ensure HSB for this block
  background(backgroundHSBColor); // HSB color

  // Update sliders
  sliderSize.update();
  sliderSpeed.update();

  // --- Rotating gradient square ---
  translate(width/2, height/2 - 50);
  rotate(angle);

  let s = sliderSize.value;

  // Gradient + shadow + BLUR for square
  myEffectShape.linearGradient(-s/2, -s/2, s/2, s/2,
    squareStartHSBColor, // HSB colors
    squareEndHSBColor);
  
  // Enable blur for this square
  myEffectShape.blur(true, 5); // Enable blur with 5px intensity
  myEffectShape.applyEffects(); // Apply shadow and blur
  
  rect(0, 0, s, s, 50);

  angle += sliderSpeed.value; // rotation

  // Reset transformations and ALL effects
  resetMatrix(); // Reset translate and rotate
  myEffectShape.resetEffects(); // Remove shadow AND blur to avoid affecting sliders and text

  // --- Draw sliders and labels (RGB / HSB - as defined) ---
  // Sliders are drawn with their own RGB colors defined in setup.
  // `fill` for labels will use HSB color defined as `labelHSBColor`.

  sliderSize.draw();
  sliderSpeed.draw();

  noStroke();
  fill(labelHSBColor); // Use predefined HSB color
  textAlign(LEFT, TOP);
  text("Size", 420, 640);
  text("Speed", 420, 690);
}

function mousePressed() {
  sliderSize.pressed();
  sliderSpeed.pressed();
}

function mouseReleased() {
  sliderSize.released();
  sliderSpeed.released();
}
</script>

</body>
</html>
